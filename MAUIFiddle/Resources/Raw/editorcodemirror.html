<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="codemirror/lib/codemirror.css">
	<link rel="stylesheet" href="codemirror/theme/material-darker.css">
	<script src="codemirror/lib/codemirror.js" onerror="alert('codemirror')"></script>
	<script src="codemirror/mode/javascript/javascript.js" onerror="alert('javascript')"></script>
	<style>
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
			overflow: hidden;
		}

		#editor {
			height: 100%;
		}

		.CodeMirror {
			height: 100% !important;
		}
	</style>
</head>

<body>
	<textarea id="editor">// Hello from CodeMirror</textarea>

	<script>
		const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
			lineNumbers: true,
			mode: "javascript",
			theme: "material-darker",
			indentWithTabs: true,
			indentUnit: 3,       // This defines the visual width of a tab character
			tabSize: 3,          // Also controls how wide a tab appears
		});

		window.getEditorContent = function () {
			return editor.getValue();
		};

		function decodeHtml(html) {
			const t = document.createElement("textarea");
			t.innerHTML = html;
			return t.value;
		}

		// Make accessible from MAUI
		window.setEditorText = function (text) {
			if (editor) {
				var code = text.replace(/\+/g, " ");
				var decoded = decodeURIComponent(code);
				//decoded = decoded.replace(/\+/g, " ");
				editor.setValue(decoded);
			}
		};

		window.setEditorFontSize = function (size) {
			if (editor) {
				document.querySelector(".CodeMirror").style.fontSize = size + "px";
				editor.refresh(); // Required to apply visual changes
			}
		};

		editor.on("change", function (cm, event) {
			const text = editor.getValue();
			const content = encodeURIComponent(text);
			window.location = "callback://editor/?text=" + content;
		});

		window.location = "callback://editor/?status=done";
	</script>
</body>
</html>